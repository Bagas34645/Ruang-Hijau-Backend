â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                   ğŸ¤– CHATBOT ERROR FIX - QUICK REFERENCE                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ THE PROBLEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  502 Bad Gateway  â†’  Missing .env config          âœ… FIXED                â”‚
â”‚  500 Server Error â†’  Gunicorn timeout too short   âœ… FIXED                â”‚
â”‚                                                                             â”‚
â”‚  When chatbot request came in:                                             â”‚
â”‚  1. Database lookup (5s) âœ…                                                â”‚
â”‚  2. Embedder loading (30-60s) â³                                            â”‚
â”‚  3. Gunicorn timeout triggers (30s default) âŒ                             â”‚
â”‚  4. Response: 500 Internal Server Error âŒ                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ THE SOLUTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Update Gunicorn Config:  timeout=30s  â†’  timeout=120s                    â”‚
â”‚                                                                             â”‚
â”‚  OLD (broken):                                                              â”‚
â”‚  gunicorn app:app --bind 0.0.0.0:8000                                     â”‚
â”‚                                                                             â”‚
â”‚  NEW (fixed):                                                               â”‚
â”‚  gunicorn app:app --bind 0.0.0.0:8000 --timeout 120 --workers 2          â”‚
â”‚                                            â†‘â†‘â†‘ KEY FIX!                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ INSTALL (2 STEPS) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Step 1: RUN SETUP SCRIPT (Recommended)                                   â”‚
â”‚  $ sudo bash /home/ubuntu/Ruang-Hijau-Backend/setup_service.sh            â”‚
â”‚                                                                             â”‚
â”‚  Step 2: VERIFY IT WORKS                                                   â”‚
â”‚  $ sudo systemctl status flask                                             â”‚
â”‚  $ curl http://localhost:8000/api/                                        â”‚
â”‚                                                                             â”‚
â”‚  OR Manual Steps:                                                           â”‚
â”‚  $ sudo cp flask.service /etc/systemd/system/flask.service               â”‚
â”‚  $ sudo systemctl daemon-reload                                           â”‚
â”‚  $ sudo systemctl restart flask                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ TEST THE FIX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  1. Service Status (instant):                                              â”‚
â”‚     $ sudo systemctl status flask                                          â”‚
â”‚     â†’ Should show: active (running)                                        â”‚
â”‚                                                                             â”‚
â”‚  2. API Test (2-3 seconds):                                                â”‚
â”‚     $ curl http://localhost:8000/api/                                     â”‚
â”‚     â†’ Should return JSON with endpoints                                    â”‚
â”‚                                                                             â”‚
â”‚  3. Chatbot Test First Request (30-60 seconds):                            â”‚
â”‚     $ curl -X POST http://localhost:8000/api/chatbot/chat \              â”‚
â”‚         -H "Content-Type: application/json" \                             â”‚
â”‚         -d '{"message": "Apa itu daur ulang?"}'                           â”‚
â”‚     â†’ WAIT 30-60 SECONDS! Then:                                           â”‚
â”‚     â†’ Should return: {"success": true, "response": "...", ...}           â”‚
â”‚                                                                             â”‚
â”‚  4. Chatbot Test Second Request (2-5 seconds):                             â”‚
â”‚     $ curl -X POST http://localhost:8000/api/chatbot/chat \              â”‚
â”‚         -H "Content-Type: application/json" \                             â”‚
â”‚         -d '{"message": "Apa manfaat pohon?"}'                            â”‚
â”‚     â†’ Should be MUCH FASTER (embedder already loaded)                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ WHAT'S INSTALLED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Configuration:                                                             â”‚
â”‚  âœ… .env              (RAG database credentials)                           â”‚
â”‚  âœ… flask.service     (Systemd service file - 120s timeout)               â”‚
â”‚  âœ… gunicorn_config.py (Gunicorn settings)                                â”‚
â”‚                                                                             â”‚
â”‚  Documentation:                                                             â”‚
â”‚  ğŸ“– README_FIX.md              (START HERE - Overview)                    â”‚
â”‚  ğŸ“– QUICK_FIX.md               (3-step setup)                            â”‚
â”‚  ğŸ“– GUNICORN_TIMEOUT_FIX.md    (Detailed guide)                          â”‚
â”‚  ğŸ“– TIMEOUT_FIX_ANALYSIS.md    (Technical analysis)                      â”‚
â”‚  ğŸ“– CHATBOT_502_FIXED.md       (Environment setup)                       â”‚
â”‚  ğŸ“– COMPLETE_FIX_SUMMARY.md    (Everything)                              â”‚
â”‚                                                                             â”‚
â”‚  Scripts:                                                                   â”‚
â”‚  ğŸ”§ setup_service.sh           (Automated setup - requires sudo)          â”‚
â”‚  ğŸ”§ test_chatbot_diagnostic.py (Test all components)                      â”‚
â”‚  ğŸ”§ start_backend.sh           (Development server)                       â”‚
â”‚  ğŸ”§ start_production.sh        (Production gunicorn)                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ TROUBLESHOOTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Problem: Service won't start                                              â”‚
â”‚  â†’ Check: sudo systemctl status flask                                     â”‚
â”‚  â†’ Logs:  sudo journalctl -u flask -n 20                                 â”‚
â”‚                                                                             â”‚
â”‚  Problem: Port 8000 already in use                                         â”‚
â”‚  â†’ Kill:  sudo lsof -i :8000  â†’  sudo kill -9 <PID>                     â”‚
â”‚  â†’ Restart: sudo systemctl restart flask                                  â”‚
â”‚                                                                             â”‚
â”‚  Problem: Still getting 500 error                                          â”‚
â”‚  â†’ Check: tail -f logs/error.log                                          â”‚
â”‚  â†’ Verify: python test_chatbot_diagnostic.py                              â”‚
â”‚  â†’ Restart: sudo systemctl restart flask                                  â”‚
â”‚                                                                             â”‚
â”‚  Problem: First request is slow                                            â”‚
â”‚  â†’ This is NORMAL! Embedder model loading takes 30-60 seconds            â”‚
â”‚  â†’ Second request will be fast (2-5 seconds)                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ IMPORTANT FACTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  â±ï¸  First Chatbot Request:    30-60 seconds (NORMAL!)                    â”‚
â”‚  â±ï¸  Second+ Requests:          2-5 seconds                               â”‚
â”‚  â±ï¸  API Endpoints:             < 1 second                                â”‚
â”‚                                                                             â”‚
â”‚  ğŸ”§ Timeout Now:               120 seconds (was 30)                       â”‚
â”‚  ğŸ‘· Workers:                   2 (can handle 2 concurrent requests)       â”‚
â”‚  ğŸ“ Logging:                   File-based + systemd journal                â”‚
â”‚  ğŸ”„ Auto-restart:              Enabled                                     â”‚
â”‚                                                                             â”‚
â”‚  âœ… Tested With:               Ollama running, 20 docs in DB              â”‚
â”‚  âœ… Working On:                Port 8000 with gunicorn                    â”‚
â”‚  âœ… Safe To Deploy:            Yes (no breaking changes)                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ QUICK COMMANDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  # Status & Control                                                         â”‚
â”‚  sudo systemctl status flask                                              â”‚
â”‚  sudo systemctl restart flask                                             â”‚
â”‚  sudo systemctl stop flask                                                â”‚
â”‚  sudo systemctl start flask                                               â”‚
â”‚                                                                             â”‚
â”‚  # Logging                                                                  â”‚
â”‚  sudo journalctl -u flask -f              # Live logs                     â”‚
â”‚  tail -f logs/access.log                  # Access logs                   â”‚
â”‚  tail -f logs/error.log                   # Error logs                    â”‚
â”‚                                                                             â”‚
â”‚  # Testing                                                                  â”‚
â”‚  curl http://localhost:8000/api/          # Test API                     â”‚
â”‚  python test_chatbot_diagnostic.py        # Full diagnostic              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ¯ NEXT STEP: sudo bash /home/ubuntu/Ruang-Hijau-Backend/setup_service.shâ•‘
â•‘  âœ… Status: READY TO DEPLOY                                               â•‘
â•‘  â° Time: ~2 minutes to fix                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
